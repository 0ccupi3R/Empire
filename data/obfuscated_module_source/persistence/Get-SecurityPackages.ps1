.("{0}{1}{2}" -f'SET-i','T','eM')  ('VAR'+'ia'+'BlE:K8'+'s'+'i') (  [TYPE]("{1}{0}" -F'PpdOmaIN','A') );$Ujc7T  =  [tYPe]("{3}{4}{2}{0}{1}{6}{5}" -f'ctIOn.emIt.As','SEM','LE','r','ef','Ss','blyBuILdeRACCe');  $oat0D =  [typE]("{2}{0}{1}{3}" -F'GSaT','tRI','fLA','buTE') ;.("{0}{2}{1}" -f 'sE','-iTeM','t') ("varIabLe"+":t47"+"w") ([TypE]("{4}{3}{1}{5}{2}{0}{6}" -f'sI','.eMiT.PA','Ing','TIon','Reflec','Ck','ZE') );&("{0}{1}{2}" -f 'S','ET-Ite','m')  ("va"+"rIABle:bv"+"7t"+"e")  ( [TYPe]("{5}{2}{8}{4}{1}{3}{7}{6}{0}"-f'ONS','On.CallINgc','EFLEC','OnveN','i','r','i','t','t')  );  .("{2}{0}{1}" -f 'iab','LE','set-VAr')  Tbc2  ([Type]("{0}{1}"-F'INt3','2') );  $rv1=  [tYpE]("{5}{9}{2}{8}{7}{3}{6}{4}{1}{0}" -F 'IOn','T','ImE.iNTerOP','lliN','En','Ru','gCOnV','Ca','SeRViCeS.','nT');   $FKa  = [type]("{0}{6}{2}{4}{5}{3}{1}"-f'rUNt','HArSEt','NTe','ES.C','ROP','sErviC','iMe.I') ; $96lwu =  [tyPE]("{2}{0}{1}"-f 'pt','R','INT') ;  $7LO =  [TypE]("{0}{5}{1}{2}{6}{4}{3}"-F 'RuNTim','teR','oPseRv','s.MarsHaL','e','E.iN','IC')  ;function gE`T-SEcUR`I`TYPA`CKageS
{


    [CmdletBinding()] Param()

    
    ${D`YN`ASSemBLY} = .("{3}{2}{0}{1}" -f'e','ct','j','New-Ob') ("{2}{4}{3}{1}{0}" -f'yName','mbl','S','.Reflection.Asse','ystem')(("{1}{0}" -f'PI','SS'))
    ${as`sEMb`lyBuI`LDeR} =  $K8SI::"CurR`E`NTDO`MaiN".("{1}{3}{4}{0}{2}"-f'A','De','ssembly','fineDynami','c').Invoke(${Dyn`ASS`em`BlY},  $uJC7T::"R`un")
    ${m`Od`u`le`BUIlDER} = ${ASsEMBLyB`u`i`L`DER}.("{6}{0}{3}{5}{4}{1}{2}" -f'e','namicModu','le','f','neDy','i','D').Invoke(("{1}{0}" -f'PI','SS'), ${Fa`l`sE})

    ${flAGsc`OnStru`C`TOR} =   (  .("{1}{0}"-f'ir','d')  vAriAblE:OAT0D)."v`AlUe".("{3}{0}{1}{2}" -f'tCo','n','structor','Ge').Invoke(@())
    ${F`L`AG`sCuSt`oMaTtRi`ButE} = &("{1}{0}{2}{3}" -f'j','New-Ob','ec','t') ("{0}{6}{4}{3}{1}{2}{5}{7}"-f 'Refle','stomA','ttributeBu','it.Cu','on.Em','ilde','cti','r')(${FLAg`sC`o`N`StRuCT`OR}, @())
    ${sTr`UcTATTRiB`ut`Es} = ("{8}{18}{9}{1}{14}{7}{4}{2}{16}{5}{6}{12}{17}{3}{11}{10}{0}{13}{15}"-f'ldI','o','Class, Pub','led, Befor','lass, ','tialLayout',',','C','A','toLay','Fie','e',' Se','n','ut, Ansi','it','lic, Sequen','a','u')

    ${enUM`B`ui`LDER} = ${m`odUlE`BUI`L`dER}.("{0}{2}{1}"-f'Define','um','En').Invoke(("{1}{3}{0}{2}"-f'PK','SSPI','G_FLAG','.SEC'), ("{1}{0}" -f'lic','Pub'), [Int32])
    ${eN`U`mb`UIldEr}.("{0}{1}{3}{2}" -f'Se','tCusto','Attribute','m').Invoke(${fLAG`ScuStO`M`AttriBU`TE})
    ${N`ULL} = ${enum`BUI`LDer}.("{2}{0}{3}{1}" -f 'neLiter','l','Defi','a').Invoke(("{2}{1}{0}" -f 'Y','GRIT','INTE'), 1)
    ${N`ULl} = ${eNu`m`BUi`lDEr}.("{0}{2}{1}" -f'Define','teral','Li').Invoke(("{0}{2}{1}"-f'PR','CY','IVA'), 2)
    ${nu`LL} = ${eNUMbU`I`l`dEr}.("{1}{0}{3}{2}{4}"-f'ineLit','Def','ra','e','l').Invoke(("{1}{0}{2}"-f 'N','TOKE','_ONLY'), 4)
    ${N`ull} = ${EN`uM`BUil`dER}.("{0}{1}{2}" -f'Defin','eLiter','al').Invoke(("{1}{0}{2}" -f'ATA','D','GRAM'), 8)
    ${Nu`ll} = ${eN`UmBU`IldER}.("{3}{2}{4}{0}{1}" -f 'a','l','Li','Define','ter').Invoke(("{2}{1}{0}" -f 'N','NNECTIO','CO'), 0x10)
    ${nU`ll} = ${enum`B`u`ILDER}.("{0}{2}{1}"-f'Defin','al','eLiter').Invoke(("{4}{2}{0}{1}{3}" -f 'R','EQ','ULTI_','UIRED','M'), 0x20)
    ${N`UlL} = ${e`NU`MBui`LDEr}.("{3}{2}{0}{1}"-f 'eLiter','al','n','Defi').Invoke(("{0}{1}{2}"-f 'CLIEN','T_O','NLY'), 0x40)
    ${nU`lL} = ${E`NUMBuilD`eR}.("{0}{1}{2}"-f'De','f','ineLiteral').Invoke(("{1}{3}{0}{2}" -f'DED_ER','EX','ROR','TEN'), 0x80)
    ${n`Ull} = ${En`Umbu`I`ldeR}.("{2}{1}{0}{3}"-f 'e','fineLit','De','ral').Invoke(("{1}{2}{0}" -f 'ON','IM','PERSONATI'), 0x100)
    ${N`ulL} = ${ENUm`B`uIlDEr}.("{2}{0}{3}{1}" -f 'fineLi','al','De','ter').Invoke(("{1}{3}{4}{0}{2}" -f'_N','A','AME','CCEPT_WI','N32'), 0x200)
    ${n`uLl} = ${E`NuMB`UI`LDEr}.("{3}{2}{0}{1}"-f 'eLi','teral','fin','De').Invoke(("{0}{1}" -f 'STREA','M'), 0x400)
    ${n`ulL} = ${E`NumbUIld`er}.("{1}{2}{3}{0}"-f'teral','D','efi','neLi').Invoke(("{1}{2}{0}"-f'IABLE','N','EGOT'), 0x800)
    ${nU`ll} = ${E`Nu`mBU`ildEr}.("{0}{1}{2}" -f 'Defin','eLiter','al').Invoke(("{0}{1}{3}{2}" -f'GSS','_COMPAT','BLE','I'), 0x1000)
    ${nu`ll} = ${EN`UMBuil`d`ER}.("{2}{1}{0}" -f 'eral','Lit','Define').Invoke(("{0}{1}"-f'LO','GON'), 0x2000)
    ${nu`LL} = ${en`UMBU`IldER}.("{0}{1}{2}"-f 'Defi','neLitera','l').Invoke(("{0}{2}{1}"-f'A','II_BUFFERS','SC'), 0x4000)
    ${n`uLL} = ${EnU`M`BuILD`ER}.("{2}{0}{1}"-f'itera','l','DefineL').Invoke(("{1}{2}{0}"-f'MENT','F','RAG'), 0x8000)
    ${N`uLL} = ${EnUM`Bui`L`DER}.("{0}{2}{1}"-f 'Defi','eral','neLit').Invoke(("{0}{1}{2}" -f 'MU','TUAL_','AUTH'), 0x10000)
    ${NU`ll} = ${eN`umBu`iLd`er}.("{2}{0}{1}" -f 'era','l','DefineLit').Invoke(("{1}{2}{0}" -f'N','DELEG','ATIO'), 0x20000)
    ${Nu`ll} = ${e`NU`mBuiL`Der}.("{1}{0}{2}"-f 'fine','De','Literal').Invoke(("{4}{2}{3}{1}{0}"-f'KSUM','ITH_CHEC','ONLY_','W','READ'), 0x40000)
    ${n`ull} = ${e`Num`BUilDer}.("{0}{3}{2}{1}{4}"-f 'D','era','eLit','efin','l').Invoke(("{2}{1}{0}{3}" -f 'T','RICTED_','REST','OKENS'), 0x80000)
    ${Nu`lL} = ${E`NUM`BUiLd`Er}.("{3}{1}{2}{4}{0}" -f 'eral','f','ineL','De','it').Invoke(("{0}{2}{4}{3}{1}"-f 'N','DER','EG','EXTEN','O_'), 0x100000)
    ${NU`Ll} = ${enUM`B`uiLd`ER}.("{2}{0}{1}" -f 'L','iteral','Define').Invoke(("{1}{2}{0}" -f 'GOTIABLE2','N','E'), 0x200000)
    ${n`ULL} = ${E`NUM`BUi`LdEr}.("{0}{2}{1}" -f 'De','ral','fineLite').Invoke(("{4}{0}{2}{1}{3}" -f 'ER','STHRO','_PAS','UGH','APPCONTAIN'), 0x400000)
    ${n`ull} = ${ENum`BUILD`eR}.("{0}{3}{1}{4}{2}"-f 'De','in','Literal','f','e').Invoke(("{4}{5}{2}{0}{1}{3}" -f'NER_C','HEC','NTAI','KS','AP','PCO'), 0x800000)
    ${S`eCP`kg_FlAG} = ${E`NU`MB`UILdeR}.("{2}{1}{0}"-f'ype','teT','Crea').Invoke()

    ${tYP`EBuILD`eR} = ${mOdUl`eB`ui`lDEr}.("{2}{1}{0}" -f'pe','y','DefineT').Invoke(("{2}{1}{3}{4}{0}"-f 'kgInfo','SPI.','S','Se','cP'), ${STrUc`TAT`T`Rib`UTEs}, [Object],  $T47w::"s`iZe8")
    ${N`ULL} = ${Ty`PEbu`iL`DeR}.("{2}{0}{3}{1}"-f 'i','d','DefineF','el').Invoke(("{1}{2}{0}{3}" -f'iti','fCap','abil','es'), ${Secp`kG_`Fl`AG}, ("{1}{0}"-f'ic','Publ'))
    ${n`uLL} = ${typ`EBUil`der}.("{0}{3}{1}{2}"-f 'Defi','eF','ield','n').Invoke(("{1}{2}{0}" -f 'ersion','w','V'), [Int16], ("{2}{1}{0}" -f'c','bli','Pu'))
    ${N`ULL} = ${TYpEbu`I`LdER}.("{2}{0}{1}" -f'Fiel','d','Define').Invoke(("{1}{0}" -f'RPCID','w'), [Int16], ("{0}{2}{1}" -f 'Publ','c','i'))
    ${n`ull} = ${tyPe`B`uiLd`er}.("{2}{1}{0}" -f'd','fineFiel','De').Invoke(("{2}{0}{1}"-f 'xTo','ken','cbMa'), [Int32], ("{1}{0}" -f 'c','Publi'))
    ${n`ULl} = ${TyPEbu`ILd`Er}.("{2}{1}{0}" -f 'Field','fine','De').Invoke(("{0}{1}"-f'Na','me'), [IntPtr], ("{0}{1}"-f'Pub','lic'))
    ${Nu`LL} = ${TYpEBU`i`lDer}.("{0}{1}{3}{2}" -f'DefineFi','e','d','l').Invoke(("{1}{0}{2}"-f 'omm','C','ent'), [IntPtr], ("{0}{1}"-f'P','ublic'))
    ${s`ecPk`GiN`Fo} = ${TyP`E`B`UILdeR}.("{3}{2}{1}{0}"-f'pe','eTy','reat','C').Invoke()

    ${Ty`PE`BuiLDeR} = ${MoD`uL`Eb`UiLd`er}.("{0}{2}{1}" -f 'D','pe','efineTy').Invoke(("{3}{2}{0}{1}"-f '.','Secur32','SPI','S'), ("{2}{0}{1}"-f 'blic, C','lass','Pu'))
    ${p`InvOKE`mETh`od} = ${T`yP`EbUilD`Er}.("{0}{4}{2}{1}{3}" -f 'Defi','okeMetho','PInv','d','ne').Invoke(("{1}{3}{4}{2}{0}" -f'ges','EnumerateS','yPacka','ecu','rit'),
        ("{1}{0}{3}{2}"-f 'e','s','dll','cur32.'),
        ("{0}{3}{1}{2}"-f 'Public','tat','ic',', S'),
         ( &("{0}{2}{1}"-f'gET-','IABLE','VAR') ("b"+"V7te") )."Val`UE"::"Sta`NDARD",
        [Int32],
        [Type[]] @(  $TBC2.("{2}{0}{1}" -f 'ByRef','Type','Make').Invoke(),
             $96LWU.("{3}{1}{2}{4}{0}"-f'pe','eBy','Re','Mak','fTy').Invoke()),
         (&("{1}{2}{0}" -f 'E','vAriaB','L')  rv1 -vaLu )::"W`INa`Pi",
          (  &("{1}{0}" -f'bLe','vaRIa')  ('FK'+'A') )."V`Alue"::"A`NSi")

    ${sec`u`R32} = ${ty`P`EBUi`lDer}.("{0}{2}{1}{3}" -f 'Cr','t','ea','eType').Invoke()

    ${pAc`ka`g`ecounT} = 0
    ${pA`ckAgearRAy`P`Tr} =  (  .('LS')  vArIAblE:96lWU  )."Val`UE"::"Ze`RO"
    ${rE`SUlt} = ${Se`cur`32}::"EnuM`E`R`AtES`eCurIty`packa`g`ES"([Ref] ${P`ACKA`GE`cOUnT}, [Ref] ${pAC`KaG`eA`RraY`PTr})

    if (${rE`Su`lT} -ne 0)
    {
        throw "Unable to enumerate seucrity packages. Error (0x$($Result.ToString('X8'))) "
    }

    if (${P`AC`K`AGEcounT} -eq 0)
    {
        .("{2}{0}{3}{4}{1}"-f'it','se','Wr','e-Ver','bo') ("{6}{3}{10}{2}{11}{9}{12}{5}{0}{8}{4}{7}{1}" -f'ed ',' packages.','e are n','h','u','l','T','rity','sec',' i','er','o','nstal')
        return
    }

    ${S`TRUCTAD`D`RE`SS} = ${PAc`kAgeArr`AY`PtR}

    foreach (${i} in 1..${paCk`Ag`ECOuNt})
    {
        ${sECPAcK`AG`E`StRu`Ct} =  ( .("{2}{0}{1}" -f'iT','EM','get-') VaRIablE:7lo)."V`AlUe"::"PT`RTO`S`TrUCT`Ure"(${St`RUct`AdDr`eSs}, [Type] ${Se`C`P`kgInFO})
        ${stru`CTa`DDreSs} = [IntPtr] (${sTr`uCTADD`Re`ss}.("{1}{0}"-f'oInt64','T').Invoke() +  (  &("{0}{1}{2}"-f'VA','riA','bLe')  7lO  -va )::"s`iZe`oF"([Type] ${seCPkg`IN`FO}))

        ${NA`mE} = ${nU`Ll}

        if (${se`C`paCkA`ges`Tru`cT}."nA`ME" -ne  $96Lwu::"z`eRo")
        {
            ${N`Ame} =  (  .("{0}{1}"-f 'IT','eM') ('vARiAB'+'LE:'+'7lO')  )."V`AlUE"::("{0}{1}{4}{2}{3}" -f'P','trT','tringAn','si','oS').Invoke(${s`E`cP`Ac`KAgeSTrUCt}."N`AME")
        }

        ${co`MM`ENT} = ${NU`LL}

        if (${SECp`A`CkaGeStr`u`ct}."co`mMEnT" -ne  $96LWu::"Z`ERO")
        {
            ${com`me`NT} =  $7LO::("{1}{3}{2}{0}"-f 'Ansi','P','ing','trToStr').Invoke(${sE`CP`Ac`KA`gEsTrUcT}."Co`mmeNt")
        }

        ${a`TTRIB`ut`eS} = @{
            ("{0}{1}" -f'Na','me') = ${N`Ame}
            ("{1}{2}{0}" -f 't','C','ommen') = ${c`oMM`ENT}
            ("{1}{3}{2}{0}" -f 'es','Capa','liti','bi') = ${sE`CpaCKagEsT`R`UCT}."fc`A`pabILI`TIEs"
            ("{1}{0}{2}{3}"-f 'xTok','Ma','enS','ize') = ${sEcP`Ack`AgE`S`T`RucT}."cBM`AxTO`KEn"
        }

        ${s`Ecp`ACkaGE} = &("{0}{1}{2}" -f'New-','Obje','ct') ("{0}{1}"-f 'PS','Object') -Property ${A`T`TrIbu`Tes}
        ${seC`PAcKa`gE}."ps`OB`JECt"."T`yPeNam`Es"[0] = ("{1}{4}{2}{3}{0}"-f 'O','SECUR','CP','KGINF','32.SE')

        ${s`ECP`AC`kAGe}
    }
}